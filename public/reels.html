<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Reels - Reel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./app-styles.css">
</head>
<body class="bg-gray-50 flex justify-center items-center min-h-screen py-12">

    <div class="floating-animation relative">
        <div class="phone-mockup w-[320px] h-[640px] rounded-[3rem] p-3 relative">
            <div class="phone-screen w-full h-full rounded-[2.5rem] overflow-hidden relative">
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-6 bg-black rounded-b-2xl z-10"></div>
                
                <div id="reels-container" class="w-full h-full bg-black overflow-y-auto snap-y snap-mandatory">
                    </div>
                
                <footer class="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 flex items-center justify-around z-20">
                    <a href="/main.html" class="flex flex-col items-center py-1 text-gray-400"><p>Î©îÏù∏</p></a>
                    <a href="/reels.html" class="flex flex-col items-center py-1 text-orange-500"><div class="bg-orange-500 rounded-2xl px-4 py-2"><p class="text-white text-sm">Î¶¥Ïä§</p></div></a>
                    <a href="/profile.html" class="flex flex-col items-center py-1 text-gray-400"><p>ÎßàÏù¥ÌéòÏù¥ÏßÄ</p></a>
                </footer>
            </div>
            <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-32 h-1 bg-white/30 rounded-full"></div>
        </div>
        <div class="absolute inset-0 rounded-[3rem] bg-gradient-to-br from-white/10 via-transparent to-transparent pointer-events-none"></div>
    </div>

    <div id="modal-container"></div>

    <script src="/__/firebase/12.3.0/firebase-app-compat.js"></script>
    <script src="/__/firebase/12.3.0/firebase-auth-compat.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script src="./app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reelsData = [
                { id: 1, restaurant: "Ìï†Î®∏ÎãàÍπÄÎ∞•", username: "@Ìï†Î®∏ÎãàÍπÄÎ∞•", description: "Ïñ¥Î®∏ÎãàÏùò ÏÜêÎßõ Í∑∏ÎåÄÎ°ú, Ï†ïÏÑ± Í∞ÄÎìù ÏßëÍπÄÎ∞• üè°", videoSrc: "./reels-media/vid1.mp4", thumbnail: "./main-media/korean-kimchi-jjigae-cooking.jpg", likes: 90, comments: 15, price: 5300, isLiked: false },
                { id: 2, restaurant: "ÌïúÏò•ÏàúÎåÄÍµ≠", username: "@ÌïúÏò•ÏàúÎåÄÍµ≠", description: "Ï†ÑÏ£º Îã≠ÎèÑÎ¶¨ÌÉï.Î¨µÏùÄÏßÄ Ï∞∏ÏπòÎßêÏù¥ ÎßõÏßë ÌôïÏû•ÌõÑ Ïû¨Ïò§Ìîà üêî", videoSrc: "./reels-media/vid2.mp4", thumbnail: "./main-media/korean-blood-sausage-soup.jpg", likes: 146, comments: 28, price: 13000, isLiked: false },
                { id: 3, restaurant: "ÎåÄÎ∞ïÍ∞àÎπÑÏßë", username: "@ÎåÄÎ∞ïÍ∞àÎπÑÏßë", description: "ÏÉùÎß•Ïóê Î∞îÏÇ≠Ìïú ÌÜµÎã≠ ÌïúÏûÖÏù¥Î©¥.. Ïó¨Î¶Ñ ÌñâÎ≥µ ÎÅùÏû•ÎÇ©ÎãàÎã§ üç∫ü§ç", videoSrc: "./reels-media/vid3.mp4", thumbnail: "./main-media/korean-galbi-ribs-set-meal-with-side-dishes.jpg", likes: 156, comments: 23, price: 12000, isLiked: false },
            ];
            const addOnsData = [
                { name: "ÍπÄÏπòÏ∞åÍ∞ú", price: 3000 }, { name: "ÏÜåÏ£º (Ï∞∏Ïù¥Ïä¨)", price: 1900 }, { name: "Í≥µÍ∏∞Î∞• Ï∂îÍ∞Ä", price: 1200 },
            ];
            
            const reelsContainer = document.getElementById('reels-container');
            const modalContainer = document.getElementById('modal-container');

            // 1. Create the HTML for all reels
            reelsData.forEach(reel => {
                const reelElement = document.createElement('div');
                reelElement.className = 'w-full h-full relative flex-shrink-0 snap-start';
                reelElement.innerHTML = `
                    <video class="w-full h-full object-cover" src="${reel.videoSrc}" autoplay muted loop playsinline></video>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-black/20"></div>
                    <div class="absolute right-2 top-1/2 transform -translate-y-1/2 flex flex-col items-center space-y-6 z-10">
                        <button class="like-btn flex flex-col items-center" data-reel-id="${reel.id}"><svg class="w-8 h-8 ${reel.isLiked ? 'text-red-500 fill-current' : 'text-white'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.5l1.318-1.182a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.318a4.5 4.5 0 010-6.364z"></path></svg><span class="like-count text-white text-sm mt-1 font-medium">${reel.likes}</span></button>
                        <button class="comment-btn flex flex-col items-center"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 5.523-4.477 10-10 10S1 17.523 1 12 5.477 2 11 2s10 4.477 10 10z"></path></svg><span class="text-white text-sm mt-1 font-medium">${reel.comments}</span></button>
                        <button class="share-btn"><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path></svg></button>
                    </div>
                    <div class="absolute bottom-[80px] left-4 right-4 text-white z-10">
                        <h3 class="text-xl font-bold mb-1">${reel.restaurant}</h3><p class="text-green-400 mb-2">${reel.username}</p><p class="text-sm leading-relaxed mb-4">${reel.description}</p>
                        <button class="order-btn w-full bg-orange-500 text-white py-3 px-6 rounded-full font-bold text-base shadow-lg hover:bg-orange-600 transition-colors" data-reel-id="${reel.id}">Ï£ºÎ¨∏ÌïòÍ∏∞ ‚Ç©${reel.price}</button>
                    </div>`;
                reelsContainer.appendChild(reelElement);
            });

            // 2. Use an Intersection Observer to play only the visible video
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const video = entry.target.querySelector('video');
                    if (entry.isIntersecting) video.play(); else video.pause();
                });
            }, { threshold: 0.5 });
            document.querySelectorAll('#reels-container > div').forEach(reel => observer.observe(reel));

            // 3. Main event listener for all buttons
            reelsContainer.addEventListener('click', function(event) {
                const target = event.target;
                if (target.closest('.like-btn')) handleLike(target.closest('.like-btn'));
                if (target.closest('.comment-btn')) alert('ÎåìÍ∏Ä Í∏∞Îä•ÏùÄ Í≥ß Ï∂îÍ∞ÄÎê©ÎãàÎã§!');
                if (target.closest('.share-btn')) alert('Í≥µÏú† Í∏∞Îä•ÏùÄ Í≥ß Ï∂îÍ∞ÄÎê©ÎãàÎã§!');
                if (target.closest('.order-btn')) {
                    const reelId = parseInt(target.closest('.order-btn').dataset.reelId);
                    openOrderModal(reelsData.find(r => r.id === reelId));
                }
            });

            // 4. Button Handlers
            function handleLike(likeBtn) {
                const reelId = parseInt(likeBtn.dataset.reelId);
                const reel = reelsData.find(r => r.id === reelId);
                reel.isLiked = !reel.isLiked;
                reel.likes += reel.isLiked ? 1 : -1;
                likeBtn.querySelector('.like-count').textContent = reel.likes;
                likeBtn.querySelector('svg').classList.toggle('text-red-500', reel.isLiked);
                likeBtn.querySelector('svg').classList.toggle('fill-current', reel.isLiked);
                likeBtn.querySelector('svg').classList.toggle('text-white', !reel.isLiked);
            }

            function openOrderModal(reel) {
                let quantity = 1;
                let selectedAddOns = [];
                modalContainer.innerHTML = `
                    <div class="modal-overlay open fixed inset-0 bg-black/50 z-50 flex items-end">
                        <div class="modal-content bg-white w-full rounded-t-3xl max-h-[85%] overflow-y-auto">
                            <div class="flex items-center justify-between p-4 border-b border-gray-200 sticky top-0 bg-white"><h2 class="text-xl font-bold">Ï£ºÎ¨∏ÌïòÍ∏∞</h2><button class="close-modal-btn">&times;</button></div>
                            <div class="p-4">
                                <div class="flex items-center gap-4 mb-6"><div class="w-20 h-20 rounded-2xl overflow-hidden"><img src="${reel.thumbnail}" class="w-full h-full object-cover"/></div><div class="flex-1"><h3 class="text-lg font-bold">${reel.restaurant}</h3><p class="text-gray-600">${reel.username}</p><p class="text-xl font-bold text-green-600">‚Ç©${reel.price}</p></div></div>
                                <div class="mb-6"><h4 class="font-semibold mb-3">ÏàòÎüâ</h4><div class="flex items-center justify-center gap-4"><button id="decrease-qty" class="w-12 h-12 rounded-full border border-gray-300 flex items-center justify-center">-</button><span id="quantity" class="text-2xl font-bold w-8 text-center">${quantity}</span><button id="increase-qty" class="w-12 h-12 rounded-full bg-orange-500 text-white flex items-center justify-center">+</button></div></div>
                                <div class="mb-6"><h4 class="font-semibold mb-3">Ï∂îÍ∞Ä ÏòµÏÖò</h4><div class="space-y-3">${addOnsData.map(addon => `<div class="flex items-center justify-between p-3 border border-gray-200 rounded-lg"><div class="flex items-center gap-3"><input type="checkbox" data-name="${addon.name}" data-price="${addon.price}" class="addon-checkbox w-5 h-5 text-green-600 rounded"/><span>${addon.name}</span></div><span class="text-gray-600">+‚Ç©${addon.price}</span></div>`).join('')}</div></div>
                                <div class="mb-6"><h4 class="font-semibold mb-3">Í≤∞Ï†ú Î∞©Î≤ï</h4><div class="space-y-3">${["Ïπ¥Ïπ¥Ïò§ÌéòÏù¥", "Ïã†Ïö©Ïπ¥Îìú", "ÎÑ§Ïù¥Î≤ÑÌéòÏù¥"].map((m, i) => `<div class="flex items-center p-3 border border-gray-200 rounded-lg"><input type="radio" name="payment" ${i===0 ? 'checked' : ''} class="w-5 h-5 text-green-600"/><span class="ml-3">${m}</span></div>`).join('')}</div></div>
                                <div class="flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-lg"><span class="text-lg font-bold">Ï¥ù Í≤∞Ï†ú Í∏àÏï°</span><span id="total-price" class="text-2xl font-bold text-green-600"></span></div>
                                <button id="final-order-btn" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-bold text-lg">Ï£ºÎ¨∏ÌïòÍ∏∞</button>
                            </div>
                        </div>
                    </div>`;
                
                const modalOverlay = modalContainer.querySelector('.modal-overlay');
                const updateTotalPrice = () => {
                    const addOnsPrice = selectedAddOns.reduce((total, addon) => total + addon.price, 0);
                    const total = (reel.price + addOnsPrice) * quantity;
                    modalOverlay.querySelector('#total-price').textContent = `‚Ç©${total}`;
                };

                modalOverlay.addEventListener('click', e => {
                    if (e.target.classList.contains('close-modal-btn') || e.target === modalOverlay) modalContainer.innerHTML = '';
                    if (e.target.id === 'decrease-qty') { if (quantity > 1) quantity--; modalOverlay.querySelector('#quantity').textContent = quantity; updateTotalPrice(); }
                    if (e.target.id === 'increase-qty') { quantity++; modalOverlay.querySelector('#quantity').textContent = quantity; updateTotalPrice(); }
                    if (e.target.classList.contains('addon-checkbox')) {
                        const { name, price } = e.target.dataset;
                        if (e.target.checked) selectedAddOns.push({ name, price: parseInt(price) });
                        else selectedAddOns = selectedAddOns.filter(a => a.name !== name);
                        updateTotalPrice();
                    }
                    if (e.target.id === 'final-order-btn') {
                        modalContainer.innerHTML = '';
                        showOrderSuccess();
                    }
                });
                updateTotalPrice();
            }

            function showOrderSuccess() {
                const successEl = document.createElement('div');
                successEl.className = 'fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50';
                successEl.innerHTML = `<div class="success-popup bg-white rounded-2xl p-8 text-center max-w-sm w-full"><div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg></div><h3 class="text-xl font-bold mb-2">Ï£ºÎ¨∏ ÏÑ±Í≥µ!</h3><p class="text-gray-600">Ï£ºÎ¨∏Ïù¥ Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.</p></div>`;
                modalContainer.appendChild(successEl);
                setTimeout(() => modalContainer.innerHTML = '', 3000);
            }
        });
    </script>
</body>
</html> 